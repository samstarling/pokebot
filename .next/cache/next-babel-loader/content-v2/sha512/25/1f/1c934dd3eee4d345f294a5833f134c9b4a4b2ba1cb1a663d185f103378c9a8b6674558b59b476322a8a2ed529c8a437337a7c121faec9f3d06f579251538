{"ast":null,"code":"import { DateTime } from \"luxon\";\nimport { emojiFor, statusFor, imageFor, renderType, assignRandomPokemon } from \"../pokemon\";\nexport default {\n  id: \"whos-that-pokemon\",\n  triggerPhrase: \"Who's that Pokémon?\",\n  respond: async ({\n    event,\n    client,\n    pokeRepo,\n    rollRepo\n  }) => {\n    const today = DateTime.local();\n    const where = {\n      generation: 1\n    }; // Generation 2 Thursdays\n\n    if (today.weekday === 4) {\n      where.generation = 2;\n    } // Legendary Christmas Day\n\n\n    if (today.day === 25 && today.month === 12) {\n      where.generation = undefined;\n      where.isLegendary = true;\n    }\n\n    assignRandomPokemon(pokeRepo, rollRepo, event.team, event.user, where).then(async roll => {\n      const message = `:${emojiFor(roll.pokemon)}: It’s me, ${roll.pokemon.name}!`;\n      const firstMessage = await client.chat.postMessage({\n        channel: event.channel,\n        text: `<@${event.user}>: ${message}`,\n        icon_url: imageFor(roll.pokemon),\n        username: roll.pokemon.name\n      });\n      const status = statusFor(roll.pokemon);\n      let fields = [];\n\n      if (roll.pokemon.isLegendary) {\n        fields.push({\n          type: \"mrkdwn\",\n          text: \":sparkles: Legendary\"\n        });\n      }\n\n      fields = fields.concat([{\n        type: \"mrkdwn\",\n        text: renderType(roll.pokemon)\n      }, {\n        type: \"mrkdwn\",\n        text: `*HP*: ${roll.pokemon.hp}`\n      }, {\n        type: \"mrkdwn\",\n        text: `*Attack*: ${roll.pokemon.attack}`\n      }, {\n        type: \"mrkdwn\",\n        text: `*Defense*: ${roll.pokemon.defense}`\n      }, {\n        type: \"mrkdwn\",\n        text: `*Speed*: ${roll.pokemon.speed}`\n      }, {\n        type: \"mrkdwn\",\n        text: `*Sp. Attack*: ${roll.pokemon.specialAttack}`\n      }, {\n        type: \"mrkdwn\",\n        text: `*Sp. Defense*: ${roll.pokemon.specialDefense}`\n      }]);\n      await client.chat.postMessage({\n        channel: event.channel,\n        text: `<@${event.user}>: ${status}`,\n        thread_ts: firstMessage.ts,\n        icon_url: `https://gravel-pokebot.herokuapp.com/oak.png`,\n        username: \"Professor Oak\",\n        blocks: [{\n          type: \"section\",\n          text: {\n            type: \"mrkdwn\",\n            text: status\n          },\n          fields,\n          accessory: {\n            type: \"image\",\n            image_url: imageFor(roll.pokemon),\n            alt_text: roll.pokemon.name\n          }\n        }]\n      });\n    });\n  }\n};","map":null,"metadata":{},"sourceType":"module"}