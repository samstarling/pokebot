{"ast":null,"code":"import { emojiFor, statusFor, assignRandomPokemon } from \"../pokemon\";\nexport default {\n  id: \"whos-that-pokemon\",\n  triggerPhrase: \"Who's that Pokémon?\",\n  respond: async (event, client, prisma) => {\n    const day = new Date().getDay();\n    let generation = 1;\n\n    if (day === 4) {\n      generation = 2;\n    }\n\n    assignRandomPokemon(prisma, event.team, event.user, generation).then(async roll => {\n      let message = `:${emojiFor(roll.Pokemon)}: It’s me, ${roll.Pokemon.name}!`;\n\n      if (generation === 2) {\n        message = `:${emojiFor(roll.Pokemon)}: Thursday means 2nd gen Pokés for everyone: it’s me, ${roll.Pokemon.name}!`;\n      }\n\n      const firstMessage = await client.chat.postMessage({\n        channel: event.channel,\n        text: `<@${event.user}>: ${message}`,\n        icon_url: `https://pokeres.bastionbot.org/images/pokemon/${roll.Pokemon.number}.png`,\n        username: roll.Pokemon.name\n      });\n      const status = statusFor(roll.Pokemon);\n      await client.chat.postMessage({\n        channel: event.channel,\n        text: `<@${event.user}>: ${status}`,\n        thread_ts: firstMessage.ts,\n        icon_url: `https://gravel-pokebot.herokuapp.com/oak.png`,\n        username: \"Professor Oak\",\n        blocks: [{\n          type: \"section\",\n          text: {\n            type: \"mrkdwn\",\n            text: status\n          },\n          fields: [{\n            type: \"mrkdwn\",\n            text: `*Type*: ${roll.Pokemon.primaryType} / ${roll.Pokemon.secondaryType}`\n          }, {\n            type: \"mrkdwn\",\n            text: `*HP*: ${roll.Pokemon.hp}`\n          }, {\n            type: \"mrkdwn\",\n            text: `*Attack*: ${roll.Pokemon.attack}`\n          }, {\n            type: \"mrkdwn\",\n            text: `*Defense*: ${roll.Pokemon.defense}`\n          }, {\n            type: \"mrkdwn\",\n            text: `*Speed*: ${roll.Pokemon.speed}`\n          }, {\n            type: \"mrkdwn\",\n            text: `*Sp. Attack*: ${roll.Pokemon.specialAttack}`\n          }, {\n            type: \"mrkdwn\",\n            text: `*Sp. Defense*: ${roll.Pokemon.specialDefense}`\n          }],\n          accessory: {\n            type: \"image\",\n            image_url: `https://pokeres.bastionbot.org/images/pokemon/${roll.Pokemon.number}.png`,\n            alt_text: roll.Pokemon.name\n          }\n        }]\n      });\n    });\n  }\n};","map":{"version":3,"sources":["/Users/samstarling/Development/personal/pokebot/lib/responders/assign.ts"],"names":["emojiFor","statusFor","assignRandomPokemon","id","triggerPhrase","respond","event","client","prisma","day","Date","getDay","generation","team","user","then","roll","message","Pokemon","name","firstMessage","chat","postMessage","channel","text","icon_url","number","username","status","thread_ts","ts","blocks","type","fields","primaryType","secondaryType","hp","attack","defense","speed","specialAttack","specialDefense","accessory","image_url","alt_text"],"mappings":"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","sourcesContent":["import { WebClient, WebAPICallResult } from \"@slack/web-api\";\nimport { PrismaClient } from \"@prisma/client\";\n\nimport { MentionEvent } from \"../slack\";\nimport { Responder } from \"./\";\nimport { emojiFor, statusFor, assignRandomPokemon } from \"../pokemon\";\n\ntype PostMessageResult = WebAPICallResult & {\n  ts: string;\n};\n\nexport default {\n  id: \"whos-that-pokemon\",\n  triggerPhrase: \"Who's that Pokémon?\",\n  respond: async (\n    event: MentionEvent,\n    client: WebClient,\n    prisma: PrismaClient\n  ) => {\n    const day = new Date().getDay();\n\n    let generation = 1;\n    if (day === 4) {\n      generation = 2;\n    }\n\n    assignRandomPokemon(prisma, event.team, event.user, generation).then(\n      async (roll) => {\n        let message = `:${emojiFor(roll.Pokemon)}: It’s me, ${\n          roll.Pokemon.name\n        }!`;\n\n        if (generation === 2) {\n          message = `:${emojiFor(\n            roll.Pokemon\n          )}: Thursday means 2nd gen Pokés for everyone: it’s me, ${\n            roll.Pokemon.name\n          }!`;\n        }\n\n        const firstMessage = (await client.chat.postMessage({\n          channel: event.channel,\n          text: `<@${event.user}>: ${message}`,\n          icon_url: `https://pokeres.bastionbot.org/images/pokemon/${roll.Pokemon.number}.png`,\n          username: roll.Pokemon.name,\n        })) as PostMessageResult;\n\n        const status = statusFor(roll.Pokemon);\n\n        await client.chat.postMessage({\n          channel: event.channel,\n          text: `<@${event.user}>: ${status}`,\n          thread_ts: firstMessage.ts,\n          icon_url: `https://gravel-pokebot.herokuapp.com/oak.png`,\n          username: \"Professor Oak\",\n          blocks: [\n            {\n              type: \"section\",\n              text: {\n                type: \"mrkdwn\",\n                text: status,\n              },\n              fields: [\n                {\n                  type: \"mrkdwn\",\n                  text: `*Type*: ${roll.Pokemon.primaryType} / ${roll.Pokemon.secondaryType}`,\n                },\n                {\n                  type: \"mrkdwn\",\n                  text: `*HP*: ${roll.Pokemon.hp}`,\n                },\n                {\n                  type: \"mrkdwn\",\n                  text: `*Attack*: ${roll.Pokemon.attack}`,\n                },\n                {\n                  type: \"mrkdwn\",\n                  text: `*Defense*: ${roll.Pokemon.defense}`,\n                },\n                {\n                  type: \"mrkdwn\",\n                  text: `*Speed*: ${roll.Pokemon.speed}`,\n                },\n                {\n                  type: \"mrkdwn\",\n                  text: `*Sp. Attack*: ${roll.Pokemon.specialAttack}`,\n                },\n                {\n                  type: \"mrkdwn\",\n                  text: `*Sp. Defense*: ${roll.Pokemon.specialDefense}`,\n                },\n              ],\n              accessory: {\n                type: \"image\",\n                image_url: `https://pokeres.bastionbot.org/images/pokemon/${roll.Pokemon.number}.png`,\n                alt_text: roll.Pokemon.name,\n              },\n            },\n          ],\n        });\n      }\n    );\n  },\n} as Responder;\n"]},"metadata":{},"sourceType":"module"}